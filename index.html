<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="./index.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
    <link rel="stylesheet" href="./styles.css">
    <link rel="icon" href="https://sitejerk.com/images/black-square-outline-png-9.png">
    <meta property="og:title" content="Square">
    <meta property="og:description" content="DOM Manipulation, ever heard of it?">
    <meta property="og:image" content="https://sitejerk.com/images/black-square-outline-png-9.png">
    <meta property="og:url" content="https://sqr.surge.sh">
    <audio volume="0.1" id="drip" src="assets/audio/drip.wav"></audio>
    <audio id="works" src="assets/audio/fireworks.wav"></audio>
    <title>Square</title>
</head>
<script>
    function playSound(file, speed = 1, pitchShift = 1, loop = false, autoplay = true) {
        /*
        Use the play() method to start the audio. if pitchShift is true
        use the stop() method to stop the audio and destroy the object.
        If pitchShift is false use the pause() method to pause and set
        the attribute currentTime to 0 to reset the time.
        */
        if (pitchShift) {
            /*
            After weeks of searching, I have finally found a way to pitch shift audio.
            Thank you Mozilla.
            2018/03/31:
                https://developer.mozilla.org/en-US/docs/Web/API/AudioBufferSourceNode/playbackRate
                https://github.com/mdn/webaudio-examples/tree/master/decode-audio-data
                https://www.w3schools.com/jsref/prop_audio_loop.asp
            Original comments:
                use XHR to load an audio track, and
                decodeAudioData to decode it and stick it in a buffer.
                Then we put the buffer into the source
            */
            audioCtx = new(window.AudioContext || window.webkitAudioContext)();
            source = audioCtx.createBufferSource();
            request = new XMLHttpRequest();

            request.open('GET', file, true);

            request.responseType = 'arraybuffer';


            request.onload = function () {
                var audioData = request.response;

                audioCtx.decodeAudioData(audioData, function (buffer) {
                        myBuffer = buffer;
                        songLength = buffer.duration;
                        source.buffer = myBuffer;
                        source.playbackRate.value = speed;
                        source.connect(audioCtx.destination);
                        source.loop = loop;
                    },

                    function (e) {
                        "Error with decoding audio data" + e.error
                    });

            }

            request.send();
            source.play = source.start
        } else {
            source = new Audio(file)
            source.playbackRate = speed
            source.loop = loop
        }
        if (autoplay) {
            source.play()
        }
        return source
    }
    var source

    function play(pitch) {
        source = playSound('assets/audio/drip.wav', pitch);
    }

    function stop() {
        source.stop(0);
        document.getElementById('play').href = ''
        document.getElementById('play').innerHTML = 'Refresh to play again'
    }
</script>

<body>
    <div id="titleLink">
        <a id="gitlink" href="https://github.com/carlcorsini/square-button" target="_blank">
            <h1 href="https://github.com/carlcorsini/square-button" id="title">Square</h1>
        </a>
    </div>


    <section class="shape1" id="square"></section>
    <br>

    <div id="changeColorDiv">
        <form id="theForm">
            <select id="selectaAnimation" class="ui dropdown">
                <option value="random">Random Animation</option>
                <option value="spin">Spin</option>
                <option value="bounce">Bounce</option>
                <option value="move">Move</option>
            </select>
            <select id="selectaColor" class="ui dropdown">
                <option value="random">Random Color</option>
                <option value="keep">Keep Color</option>
                <option value="white">White</option>
                <option value="#1FE3C8">Teal</option>
                <option value="#05BFF2">Blue</option>
                <option value="#F20568">Red</option>
                <option value="#f06406">Orange</option>
            </select>
            <select id="selectaRipple" class="ui dropdown">
                <option value="random">Random Ripple</option>
                <option value="keep">Keep Ripple</option>
                <option value="white">White</option>
                <option value="#1FE3C8">Teal</option>
                <option value="#05BFF2">Blue</option>
                <option value="#F20568">Red</option>
                <option value="#f06406">Orange</option>
                <option value="rgba(215, 14, 255, 0.4)">Pink</option>
            </select>
            <br>
            <br>
            <button type="submit" id="changeColor" class="ui inverted teal massive button">Click Me</button>
        </form>
        <div id="bottom-left">

            <p id="scoreBox">
                <em id="score">0</em>
            </p>
        </div>
    </div>



    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
        integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.6/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.6/addons/p5.dom.js"></script>
</body>

</html>